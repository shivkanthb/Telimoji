/**
 * Aggregation example: Fetches imojis from all categories and creates a set of trending and reaction imojis
 **/

var imojiClient = new (require('../index'))({
    apiKey: process.env.IMOJI_API_KEY,
    apiSecret: process.env.IMOJI_API_SECRET
}), Promise = require('bluebird'),
	_ = require('lodash');

// fetch the categories first
imojiClient.categories().
	then(function(results) {
		// run a search for the category items
    	return Promise.all(results.categories.map(function(category) {
        	return imojiClient.search({query: category.searchText});
    	})).
    	then(function(results) {
    		// aggregate them all 
        	return _.flatten(results.map(function(result) {
        		return result.results;
        	}));
    	});
	}).
	then(function(imojis) {
		// do something fun with the imojis
	});
